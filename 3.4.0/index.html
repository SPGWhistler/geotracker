<!DOCTYPE html><!--HTML5 doctype-->
<html>
	<head>
		<title>Powered by appStarter</title>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8"> 
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<link rel='stylesheet' type='text/css' href='css/jq.ui.frosty.css' />
		<link rel="stylesheet" type="text/css" href="css/icons.css">
		<script type="text/javascript" charset="utf-8" src="http://localhost:58888/_appMobi/appmobi.js"></script> 
		<script type="text/javascript" charset="utf-8" src="http://localhost:58888/_appMobi/xhr.js"></script>  
		<script type="text/javascript" charset="utf-8" src="libs/jq.ui.min.js"></script> 
		<script type="text/javascript" charset="utf-8" src="libs/jq.web.min.js"></script> 
		<script type="text/javascript" charset="utf-8" src="libs/xpromo.js"></script> 
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

		<script type="text/javascript">
			var lastGeo = null;

			/* Prevent users from scrolling the page */
			var preventDefaultScroll = function(event) {
			    event.preventDefault();
			    window.scroll(0,0);
			    return false;
			};
			document.addEventListener('touchmove', preventDefaultScroll, false);

			/* This function runs once the page is loaded, but appMobi is not yet active */
			$.ui.autoLaunch=false;
			var init = function(){
				$.ui.showBackbutton=false;
			};
			document.addEventListener("DOMContentLoaded",init,false);

			/* This code is used to run as soon as appMobi activates */
			var onDeviceReady=function(){
				AppMobi.device.setRotateOrientation("portrait");
				AppMobi.device.setAutoRotate(false);
				AppMobi.device.hideSplashScreen();
				$.ui.launch();
				$.ui.toggleHeaderMenu();
				initMap();
				setInterval('getLocation()', 10000); //Get my location every 30 seconds
				AppMobi.geolocation.getCurrentPosition(gotLocation, noLocation);
			};
			document.addEventListener("appMobi.device.ready",onDeviceReady,false);

			function getLocation(){
				console.log('getLocation');
				var d = new Date();
				var t = d.getTime();
				if (lastGeo === null || t - lastGeo > 30) {
					console.log('doing geolocate');
					lastGeo = t;
					AppMobi.geolocation.getCurrentPosition(gotLocation, noLocation);
				}
			}

			function gotLocation(p){
				var newLL = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);
				map.panTo(newLL);
				//mybounds.extend(newLL);
				if (myMarker === null) {
					console.log('creating marker');
					myMarker = new google.maps.Marker({
						position: newLL,
						map: map,
						title: 'my current location'
					});
				} else {
					console.log('updating marker');
					myMarker.setPosition(newLL);
				}
				//map.fitBounds(mybounds);
			}
			function noLocation(){
			}

			var map;
			google.maps.visualRefresh = true;
			var mybounds = new google.maps.LatLngBounds();
			var myMarker = null;
			function initMap() {
				var mapOptions = {
					zoom: 16,
					center: new google.maps.LatLng(-34.397, 150.644),
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					streetViewControl: false
				};
				map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
			}
		</script>
	</head>
	<body>
		<div id="jQUi">
			<div id="splashscreen" class='ui-loader'>
				<span class='ui-icon ui-icon-loading spin'></span><h1 >Starting app</h1>
			</div>
			<div id="content">
				<div id='main' class='panel' style="width: 100%; height: 100%">
					<div style="width: 100%; height: 100%;" id="map-canvas"></div>
				</div>
			</div>
			<div id='navbar'>
				<a href='#' onclick="getLocation();" class='icon magnifier'>Find</a>
				<a href='#' class='icon location'>Track</a>
				<a href='#' class='icon info'>Into</a>
			</div>
		</div>
	</body>
</html>
